<div class="content">
    <div class="row">
        <div class="col-sm-6 col-sm-offset-3 col-xs-12">
            <form role="form">
                <div class="form-group">
                    <label>姓名<span style="color: red">*</span></label><span id="name">姓名不能为空</span>
                    <input type="text" class="form-control name" ng-model="client.name" style="display: block">
                </div>
                <div class="form-group">
                    <label>客户级别<span style="color: red">*</span><span id="level">客户级别不能为空</span></label>
                    <select class="form-control level" ng-model="client.level">
                        <option value="" selected="selected">--请选择客户级别--</option>
                        <option value="1">普通客户</option>
                        <option value="2">重要客户</option>
                        <option value="3">核心客户</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>手机号<span style="color: red">*</span></label><span id="phone">手机号码不能为空</span>
                    <input type="text" class="form-control phone" ng-model="client.phone" style="display: block">
                </div>
                <div class="form-group">
                    <label>性别</label>
                    <select class="form-control sex" ng-model="client.sex">
                        <option value="" selected="selected">性别</option>
                        <option value="1">男</option>
                        <option value="2">女</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>邮箱</label>
                    <input type="text" class="form-control email" ng-model="client.email">
                </div>
                <div class="form-group">
                    <label>行业<span style="color: red">*</span><span id="industry">行业不能为空</span></label>
                    <select class="form-control industry" ng-model="client.industry">
                        <option value="" selected="selected">行业</option>
                        <option value="1">类金融机构</option>
                        <option value="2">企业类</option>
                        <option value="3">商协会</option>
                        <option value="4">法律</option>
                        <option value="5">媒体</option>
                        <option value="6">学者官员</option>
                        <option value="7">东北地区</option>
                        <option value="8">其他</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>所在公司<span style="color: red">*</span></label><span id="firm">公司不能为空</span>
                    <input type="text" class="form-control firm" ng-model="client.firm" style="display: block">
                </div>
                <div class="form-group">
                    <label>企业主要业务</label>
                    <input type="text" class="form-control business" ng-model="client.business">
                </div>
                <div class="form-group">
                    <label>部门职务</label>
                    <input type="text" class="form-control position" ng-model="client.position">
                </div>
                <div class="form-group">
                    <label>座机</label>
                    <input type="text" class="form-control tel" ng-model="client.tel">
                </div>
                <div class="form-group">
                    <label>国家<span style="color: red">*</span><span id="country">国家不能为空</span></label>
                    <input type="text" class="form-control country" ng-model="client.country">
                </div>
                <div class="form-group">
                    <label>省份<span style="color: red">*</span><span id="province">省份不能为空</span></label>
                    <p>
                        <select name="P1" class="form-control province" ng-model="client.province"></select>
                    </p>
                    <!--<input type="text" class="form-control province" ng-model="client.province">-->
                </div>
                <div class="form-group">
                    <label>城市</label>
                    <select name="C1" class="form-control city" ng-model="client.city"></select>
                    <!--<input type="text" class="form-control city" ng-model="client.city" style="display: block">-->
                </div>
                <div class="form-group">
                    <label>故乡</label>
                    <input type="text" class="form-control hometown" ng-model="client.hometown">
                </div>
                <div class="form-group">
                    <label>地址</label>
                    <input type="text" class="form-control address" ng-model="client.address">
                </div>
                <div class="form-group">
                    <label>微信号</label>
                    <input type="text" class="form-control wechat" ng-model="client.wechat">
                </div>
                <div class="form-group">
                    <label>区域</label>
                    <select class="form-control area" ng-model="client.area">
                        <option value="" selected="selected">地区</option>
                        <option value="1">华东地区</option>
                        <option value="2">华南地区</option>
                        <option value="3">华中地区</option>
                        <option value="4">华北地区</option>
                        <option value="5">西北地区</option>
                        <option value="6">西南地区</option>
                        <option value="7">东北地区</option>
                        <option value="8">台港澳地区</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>案源种类</label>
                    <select class="form-control case_type" ng-model="client.case_type">
                        <option value="" selected="selected">案源类型</option>
                        <option value="1">直接案源：帮瀛给的直接案源</option>
                        <option value="2">直接案源：帮瀛模式的案源</option>
                        <option value="3">直接案源：乾成模式的案源</option>
                        <option value="4">直接案源：帮瀛没有通过进入乾成的案源</option>
                        <option value="5">渠道案源：批量，地方合作（律师、机构、个人）案源</option>
                        <option value="6">渠道案源：公司，品牌推广形成的间接案源</option>
                    </select>
                </div>

                <!--resume-->
                <div class="form-group">
                    <label>工作经历</label>
                    <div class="work">

                    </div>
                    <!--<input class="form-control" id="work" />-->
                </div>
                <p>
                    <input type="button" value="+点击添加一条工作经历" class="btn btn-default btn-block" id="work"/>
                </p>

                <!--interact-->
                <div class="form-group">
                    <label>互动信息</label>
                    <div class="instract">

                    </div>
                    <!--<input class="form-control" id="achievement" />-->
                </div>
                <p>
                    <input type="button" value="+点击添加一条互动信息" class="btn btn-default btn-block" id="instract"/>
                </p>
                <p>
                    <input type="button" value="提交" class="btn btn-success" id="sub"/>
                </p>
                <br/>
                <br/>
            </form>
        </div>
    </div>
</div>
<script src="../dist/js/PCASClass.js"></script>
<script>
    new PCAS("P1", "C1");
    $(function () {
        // 添加工作经历
        var i = 0;
        var g = 0;
        $("#work").click(function () {
            $(".work").append(
                    '<div class="panel" id="work' + i + '">' +
                    "<div class='panel-body workString'>" +
                    "<img src='../dist/img/close.png' class='remove pull-right'/>" +
                    "<div class='form-group'>" +
                    "<label>开始时间</label>" +
                    "<input type='date' class='form-control start_time' />" +
                    "</div>" +
                    "<div class='form-group'>" +
                    "<label>结束时间</label>" +
                    "<input type='date' class='form-control end_time' />" +
                    "</div>" +
                    "<div class='form-group'>" +
                    "<label>所在公司/单位</label>" +
                    "<input type='text' class='form-control company' />" +
                    "</div>" +
                    "<div class='form-group'>" +
                    "<label>职位</label>" +
                    "<input type='type' class='form-control position' />" +
                    "</div>" +
                    "</div>" +
                    "</div>"
            );
            i++;
        });
        // 添加互动
        $("#instract").click(function () {
            $(".instract").append(
                    '<div class="panel" id="ins' + g + '">' +
                    "<div class='panel-body achievementString'>" +
                    "<img src='../dist/img/close.png' class='remove pull-right'/>" +
                    "<div class='form-group'>" +
                    '<label>互动形式</label>' +
                    '<select class="form-control form" ng-model="form">' +
                    '<option selected="selected" value="1">电话</option>' +
                    '<option value="2">信息(短信或者微信)</option>' +
                    '<option value="3">会面</option>' +
                    '</select>' +
                    '<div class="form-group">' +
                    '<label>互动详情</label>' +
                    '<input type="text" class="form-control details" value="" placeholder="互动详情"/>' +
                    '</div>' +
                    '<div class="form-group">' +
                    '<label>互动时间</label>' +
                    '<input type="time" class="form-control time" value=""/>' +
                    '</div>' +
                    '<div class="form-group">' +
                    '<label>点评</label>' +
                    '<textarea class="form-control comment" placeholder="请输入点评信息"></textarea>' +
                    '</div>' +
                    '<div class="form-group">' +
                    '<label>下一步计划</label>' +
                    '<textarea class="form-control next_plan" placeholder="请输入点评信息"></textarea>' +
                    '</div>' +
                    "</div>" +
                    "</div>" +
                    "</div>"
            );
            g++;
        });
        // 删除添加
        $(document).on("click", ".remove", function () {
            $(this).parent().parent().remove();
        });

        // 验证姓名
        $(".name").blur(function () {
            if ($(this).val() == "") {
                $("#name").show();
            }
            else {
                $("#name").hide();
            }
        });
        // 验证国家
        $(".country").blur(function () {
            if ($(this).val() == "") {
                $("#country").show();
            }
            else {
                $("#country").hide();
            }
        });
        // 验证省份
        $(".province").blur(function () {
            if ($(this).val() == "" && $(".country").val() == "中国") {
                $("#province").show();
            }
            else {
                $("#province").hide();
            }
        });
        // 律所
        $(".firm").blur(function () {
            if ($(this).val() == "") {
                $("#firm").show();
            }
            else {
                $("#firm").hide();
            }
        });
        // 所在城市
        $(".city").blur(function () {
            if ($(this).val() == "") {
                $("#city").show();
            }
            else {
                $("#city").hide();
            }
        });
        // 验证手机号码
        $(".phone").blur(function () {
            if (!(/^1\d{10}$/.test($(this).val()))) {
                $("#phone").show();
            }
            else {
                $("#phone").hide();
            }
            // 验证数据库手机是否重复
            $.ajax({
                type: "get",
                data: {phone: $(".phone").val()},
                url: url + "check_phone",
                success: function (data) {
                    console.log(data);
                    $("#phone").show();
                    $("#phone").text(data.message);
                }
            })
        });
        $("#sub").click(function () {
            var name = $(".name").val();
            var phone = $(".phone").val();
            var sex = $(".sex option:selected").val();
            var email = $(".email").val();
            var firm = $(".firm").val();
            var business = $(".business").val();
            var position = $(".position").val();
            var industry = $(".industry option:selected").val();
            var area = $(".area option:selected").val();
            var tel = $(".tel").val();
            var country = $(".country").val();
            var province = $(".province option:selected").val();
            var city = $(".city option:selected").val();
            var address = $(".address").val();
            var wechat = $(".wechat").val();
            var hometown = $(".hometown").val();
            var level = $(".level option:selected").val();
            var case_type = $(".case_type option:selected").val();
            var next_plan = $(".next_plan").val();

            if (name == "" || phone == "" || firm == "" || country == "" || level == "" || industry == "") {
                alert("带*号的为必填字段");
            }
            else {
                // 工作字符串
                var client_exp = "";
                for (var j = 0; j < i; j++) {
                    if ($("#work" + j + " .start_time").val() == "" || $("#work" + j + " .end_time").val() == "" || $("#work" + j + " .company").val() == "" || $("#work" + j + " .position").val() == "") {
                        $("#work" + j + " .start_time").val("1970-10-01");
                        $("#work" + j + " .end_time").val("1970-10-01");
                        $("#work" + j + " .position").val("暂无");
                        $("#work" + j + " .company").val("暂无");
                    }
                    client_exp += $("#work" + j + " .start_time").val() + "##" + $("#work" + j + " .end_time").val() + "##" + $("#work" + j + " .company").val() + "##" + $("#work" + j + " .position").val() + "@@";
                }
                // 互动字符串
                var client_interact = "";
                for (var j = 0; j < g; j++) {
                    if ($("#ins" + j + " .form").val() == "" || $("#ins" + j + " .details").val() == "" || $("#ins" + j + " .time").val() == "" || $("#ins" + j + " .comment").val() == "" || $("#ins" + j + " .next_plan").val() == "") {
                        $("#ins" + j + " .form").val("暂无");
                        $("#ins" + j + " .details").val("暂无");
                        $("#ins" + j + " .time").val("1970-10-01");
                        $("#ins" + j + " .comment").val("暂无");
                        $("#ins" + j + " .next_plan").val("暂无");
                    }
                    client_interact += sessionStorage.getItem("id") + "##" + $("#ins" + j + " .form").val() + "##" + $("#ins" + j + " .details").val() + "##" + $("#ins" + j + " .time").val() + "##" + $("#ins" + j + " .comment").val() + "@@";
                }

                // 如果填写其他国家
                if (country != "中国") {
                    province = "";
                    city = "";
                }
                var data = {
                    uid: sessionStorage.getItem("id"),
                    name: name,
                    phone: phone,
                    email: email,
                    sex: sex,
                    industry: industry,
                    firm: firm,
                    business: business,
                    position: position,
                    tel: tel,
                    country: country,
                    province: province,
                    city: city,
                    area: area,
                    address: address,
                    wechat: wechat,
                    hometown: hometown,
                    level: level,
                    case_type: case_type,
                    resume: client_exp,
                    interact: client_exp,
                    next_plan: next_plan
                };
                if(confirm("您确定添加吗?")) {
                    $.ajax({
                        type: "post",
                        data: data,
                        url: url + "sales/client",
                        success: function (data) {
                            console.log(data);
//                            alert(data.message);
                            window.location.href = "index.html";
                        }
                    });
                }
            }
            console.log(data);
        })

    });
</script>